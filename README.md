# Проект: Тесты простоты, визуализация и отчёт (КР + ПР)

Этот репозиторий содержит код генерации данных, построения визуализаций и автоматической сборки единого отчёта `report.md` (курсовая работа + практические разделы).

---

## Установка и запуск

```bash
python -m venv .venv
# Windows:
.venv\Scripts\activate
# Linux/macOS:
source .venv/bin/activate

pip install -r requirements.txt

# Сгенерировать все данные, рисунки и md-отчёт
python main.py
```

После запуска все фигуры окажутся в каталоге `figs/`, а самодостаточный отчёт — в `report.md` (картинки встраиваются как data-URI).

---

## Что именно будет сгенерировано

- `figs/` — все рисунки (PNG), используемые в отчёте.
- `data/` — промежуточные csv/npz (если включено сохранение).
- `report.md` — итоговый отчёт (КР + ПР) в одном файле Markdown.
- `cache/` — кэш простых/факторизаций для повторяемости (опционально).

Перезапуск `main.py` полностью воспроизводим: при одинаковом `--seed` результаты совпадают.

---

## Структура проекта (КР и ПР)

```
.
├─ core/                 # Алгоритмы и базовые утилиты
│  ├─ primes.py          # решето, перебор делителей, вспом. генераторы
│  ├─ arith.py           # gcd, powmod, факторизация (при необходимости)
│  ├─ mr.py              # тест Миллера–Рабина
│  ├─ ss.py              # тест Соловея–Штрассена (символ Якоби)
│  └─ fermat.py          # тест Ферма и псевдопростые
├─ viz/                  # Построение графиков и теплокарт
│  ├─ density.py
│  ├─ gaps.py
│  ├─ heatmaps.py
│  ├─ carmichael.py
│  └─ timing.py
├─ report/               # Генерация Markdown (md_* и to_data_uri)
│  ├─ build.py
│  └─ blocks.py
├─ main.py               # Точка входа: оркестрация экспериментов и отчёта
├─ requirements.txt
└─ README.md
```

> Примечание: имена модулей могут отличаться от приведённых; важна логика разбиения — алгоритмы отдельно, визуализация отдельно, сборка отчёта отдельно.

---

## Ключевые опции `main.py`

```bash
python main.py --max-x 200000        # граница для плотности простых/разрывов
python main.py --mr-rounds 7         # число раундов Миллера–Рабина
python main.py --seed 42             # фиксируем генератор для повторяемости
python main.py --no-cache            # игнорировать кэш (медленнее)
python main.py --only report         # пересобрать только report.md
```

---

## Зачем нужны «дополнительные» методы

В проекте есть ряд маленьких, но полезных утилит — они не «про математику» напрямую, зато делают код отчёта короче и читабельнее:

- `to_data_uri(path)` — встраивает рисунки прямо в Markdown (data-URI), чтобы `report.md` был самодостаточным.
- `md_h1 / md_h2 / md_small` — хелперы разметки, чтобы единообразно оформлять подписи и разделы.
- Кэш-обёртки для генерации простых и факторизаций — резко ускоряют повторные запуски.
- Обёртки для профайлинга (`timeit_block`) — собирают честные профили времени тестов (см. «Creative 5»).
- Малые арифметические примитивы (`gcd`, `powmod`, `jacobi`) — чтобы тесты (MR/SS/Ферма) были быстрыми и независимыми от внешних пакетов.

Именно они позволяют легко добавлять новые эксперименты и пояснения — как в разделах «Creative 1–5».

---

## Содержание отчёта (КР + ПР)

### Базовая часть

- **Плотность простых и сравнение с \(x / \ln x\)**.
- **Разрывы между соседними простыми** (гистограмма и бегущий максимум).
- **Тесты простоты**: Ферма, Соловей–Штрассен, Миллер–Рабин.
- **Псевдопростые и числа Кармайкла**.
- **Профили времени**: сравнительный график для разных тестов при росте \(n\).

Каждый раздел сопровождается рисунками и краткими выводами.

---

## Дополнительные визуализации (Creative)

### Creative 1. Плотность простых и разрывы

- `pi_vs_xlogx.png` — *«pi(x) и x/ln x»*.  
  Аппроксимация \(x/\ln x\) слегка занижает \(\pi(x)\), но уже на \(x \le 2\cdot10^5\) довольно точна.

- `prime_gaps_hist.png` — *«Гистограмма разрывов между простыми»*.  
  Малые разрывы встречаются чаще; крупные редки.

- `prime_gaps_running_max.png` — *«Максимальный разрыв по мере роста p»*.  
  Максимальный наблюдаемый разрыв растёт медленно.

### Creative 2. Ошибка Миллера–Рабина (эмпирика)

- `mr_false_rate.png` — *«Доля ложноположительных для t=1..7 (ось Y логарифмическая)»*.  
  **Ось X** — число раундов \(t\), **ось Y** — доля ложноположительных (лог-шкала).  
  Точки/линия показывают почти экспоненциальное падение ошибки; именно поэтому прибавка 1–2 раундов даёт резкий прирост надёжности.

### Creative 3. Символ Якоби и Соловей–Штрассен (теплокарта)

- `jacobi_heatmap.png` — *«Мозаика значений символа Якоби»*.  
  **Ось X** — основание \(a\), **ось Y** — нечётные модули \(n\) (3..199).  
  **Цвета**: \(+1, 0, -1\). Нули там, где \(\gcd(a,n)>1\). Мозаика ±1 демонстрирует квадратичную взаимность; **именно поэтому тест Соловея–Штрассена эффективно отбрасывает много составных**.

### Creative 4. Кармайкла и псевдопростые Ферма

- `carmichael_hist.png` — *«Распределение чисел Кармайкла по диапазонам»*.  
  Числа Кармайкла — составные, проходящие тест Ферма для любого основания, взаимно простого с \(n\).  
  Плотность мала, но встречаются регулярно; это объясняет, почему «голый» тест Ферма ненадёжен.

- `fermat_heatmap.png` — *«Доли оснований, на которых n проходит тест Ферма»*.  
  Для каждого \(n\) показана доля оснований \(a\), где \(a^{n-1}\equiv1\pmod n\) (при \(\gcd(a,n)=1\)).  
  Кармайклы выделяются как строки с долей ≈1.

### Creative 5. Профили времени тестов

- `tests_timing.png` — *«Сравнение времени Миллера–Рабина, Соловея–Штрассена и Ферма»*.  
  Показано среднее время проверки при росте числа разрядов.  
  Видно, что MR с малым числом раундов даёт лучшую «скорость/надёжность», SS — дороже из-за символа Якоби, Ферма — самый быстрый, но ненадёжный.

---

## Интерпретация ключевого графика (MR error)

Для рисунка «Ошибка Миллера–Рабина (эмпирика)» оценивается доля составных \(n\), ошибочно признанных «вероятно простыми», при числе раундов \(t=1..7\).  
Падение ошибки близко к экспоненциальному: добавление каждого нового независимого основания почти умножает вероятность ошибки на константу \(\ll 1\). Отсюда практический вывод: **2–3 раунда уже дают уровни, достаточные для большинства применений**, а 5–7 раундов — запас для криптографии.

---

## Повторяемость и контроль случайности

- Все эксперименты, где есть случайный выбор оснований/примеров, фиксируют `--seed`.
- В тяжёлых местах используется кэширование факторизаций/списков простых.
- Для долговременных прогонов доступны флаги `--no-cache` и сбор профильных метрик (см. «Creative 5»).
